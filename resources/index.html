<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="with=device-width, initial-scale=1.0">
    <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->

    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>

    <style>
    .bar-chart {
        background-color : #c7d9d9;
    }
    </style>
  </head>
  <body>
    <h1>This is the version of the content in a file, from a template</h1>

    <h2>The kitten as parameter</h2>
    <img src="${imgUri}" width="300" />

    <h2>Local lines counter</h2>
    <div id="lines-of-code-counter">0</div>

    <h2>Latest communication from host</h2>
    <div id="latest-comm"></div>

    <h2>Visualization</h2>
    <div class="vizdiv">
         Hello World!
    </div>

    <!--
    <h2>SVG visualization</h2>
    <svg class="bar-chart"></svg>  
    -->

    <h2>c3 chart</h2>
    <div id="visitor" style="height:290px; width:100%;"></div>

    <script>
    (function () {
        const vscode = acquireVsCodeApi();
        const counter = document.getElementById("lines-of-code-counter");
        const commMsg = document.getElementById("latest-comm");

        let count = 0;
        setInterval( () => {
            counter.textContent = count++;
            if ((count % 250) === 0) {
                console.log("Sending a message to the host...");
                vscode.postMessage({
                    command: 'alert',
                    text: 'communicating with host'
                });
            }
        }, 500);

        /*
        // trying the code from https://medium.freecodecamp.org/how-to-create-your-first-bar-chart-with-d3-js-a0e8ea2df386
        let dataset = [80, 100, 56, 120, 180, 30, 40, 120, 160]; 
        let svgWidth = 500;
        let svgHeight = 300;
        let barPadding = 5;
        let barWidth = (svgWidth / dataset.length);

        let svg = d3.select("svg").attr("width", svgWidth).attr("height", svgHeight);
        let barChart = svg.selectAll("rect")
                          .data(dataset)
                          .enter()
                          .append("rect")
                          .attr("y", function(d) { return svgHeight - d; })
                          .attr("height", function(d) { return d; } )
                          .attr("width", function(d) { return barWidth - barPadding; })
                          .attr("transform", function(d,i) {
                            let translate = [ barWidth * i, 0];
                            return "translate(" + translate + ")";
                          });
        */

        // a second chart
        var chart = c3.generate({
            bindto: '#visitor',
            data: {
                columns: [
                    ['Open', 4],
                    ['Closed', 2],
                    ['In progress', 2],
                    ['Other', 0],
                ],
                type: 'donut',
                tooltip: {
                    show: true
                }
            },
            donut: {
                label: {
                    show: false
                },
                title: "Tickets",
                width: 35,
            },
            legend: {
                hide: true
                //or hide: 'data1'
                //or hide: ['data1', 'data2']
            },
            color: {
                pattern: ['#40c4ff', '#2961ff', '#ff821c', '#7e74fb']
            }
        });

        // Handle a message inside the webview
        window.addEventListener('message', event => {
            const message = event.data; // the message data the host sent
            commMsg.textContent = "Just received a message at time [" + count + "]";
            console.log("This should be displayed in the developer tools if they're open");
        });
    })();
    </script>
  </body>
</html>
