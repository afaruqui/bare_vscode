<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="with=device-width, initial-scale=1.0">
    
    <h1>Welcome to Vue</h1>
    <script src="https://unpkg.com/d3"></script>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-treetable/3.2.0/css/jquery.treetable.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-treetable/3.2.0/css/jquery.treetable.theme.default.min.css" />

    <style>
        .vuechart rect {
          fill: rgb(47, 103, 146);
        }
        .vuechart text {
          fill: white;
          font: 10px sans-serif;
          text-anchor: end;
        }
    </style>

    <body>
    <div>
    <svg id="vued3chart" class="vuechart"></svg>
    <h1>Chart using d3 with Vue</h1>
    </div>
    <div id="vuec3chart"></div>
    <h1>Chart using c3 with Vue</h1>
    <div id="container">
    <h1>This is the version of the content in a file, from a template</h1>

    <h2>Local lines counter</h2>
    <div id="lines-of-code-counter">0</div>

    <h2>Latest communication from host</h2>
    <div id="latest-comm"></div>
    <h2>Message</h2>
    <div id="message">0</div>
    <h2>c3 chart</h2>
    <div id="dataDiv" style="display: none;">${columnsFromHost}</div>
    <div id="dataDiv2" style="display: none;">${columnsFromHost2}</div>
    <div id="visitor" style="height:290px; width:100%;"></div>
    <div id="chart" style="height:290px; width:100%;"></div>
    <div id="chart2" style="height:290px; width:100%;"></div>
    <h2>The table of functions</h2>

    <table id="table-profile">
    <tr data-tt-id="0"><th>Function</th><th>CPU Time</th><th>Module</th><th>Function (Full)</th><th>Source File</th><th>Start Address</th></tr>
    <tr data-tt-id="1">                      <td>func@0x1e0897c0</td>      <td>12.703125</td><td>python36.dll</td><td>func@0x1e0897c0</td><td>[Unknown]</td><td>0x1e0897c0</td></tr>
    <tr data-tt-id="2" data-tt-parent-id="1"><td>_scrt_common_main_seh</td><td>12.703125</td><td>python.exe</td><td>_scrt_common_main_seh</td><td>exe_common.inl</td><td>0x1d001150</td></tr>
    <tr data-tt-id="3" data-tt-parent-id="1"><td>BaseThreadInitThunk</td><td>0</td><td>KERNEL32.DLL</td><td>BaseThreadInitThunk</td><td>[Unknown]</td><td>0x180012760</td></tr>
    <tr data-tt-id="4" data-tt-parent-id="1"><td>RtlUserThreadStart</td><td>0</td><td>ntdll.dll</td><td>RtlUserThreadStart</td><td>[Unknown]</td><td>0x180070d30</td></tr>
    <tr data-tt-id="5">                      <td>jpeg_idct_16x16</td>       <td>1.538451</td><td>opencv_imgcodecs331.dll</td><td>jpeg_idct_16x16</td><td>[Unknown]</td><td>0x180131d90</td></tr>
    <tr data-tt-id="6" data-tt-parent-id="5"><td>func@0x180123b90</td><td>1.538451</td><td>opencv_imgcodecs331.dll</td><td>func@0x180123b90</td><td>[Unknown]</td><td>0x180123b90</td></tr>
    <tr data-tt-id="7" data-tt-parent-id="5"><td>func@0x1801233b0</td><td>0</td><td>opencv_imgcodecs331.dll</td><td>func@0x1801233b0</td><td>[Unknown]</td><td>0x1801233b0</td></tr>
    <tr data-tt-id="8" data-tt-parent-id="5"><td>jpeg_read_scanlines</td><td>0</td><td>opencv_imgcodecs331.dll</td><td>jpeg_read_scanlines</td><td>[Unknown]</td><td>0x18011c900</td></tr>
    <tr data-tt-id="9" data-tt-parent-id="5"><td>cv::JpegDecoder::readData</td><td>0</td><td>opencv_imgcodecs331.dll</td><td>cv::JpegDecoder::readData(class cv::Mat &)</td><td>grfmt_jpeg.cpp</td><td>0x1800277a0</td></tr>
    <tr data-tt-id="10" data-tt-parent-id="5"><td>cv::imdecode_</td><td>0</td><td>opencv_imgcodecs331.dll</td><td>cv::imdecode_</td><td>loadsave.cpp</td><td>0x18000eb10</td></tr>

    <tr data-tt-id="11">                       <td>jpeg_idct_islow</td>       <td>1.214521</td><td>opencv_imgcodecs331.dll</td><td>jpeg_idct_16x16</td><td>jpeg_idct_islow,[Unknown]</td><td>0x180135c20</td></tr>
    <tr data-tt-id="12" data-tt-parent-id="11"><td>func@0x180123b90</td><td>1.203510</td><td>opencv_imgcodecs331.dll</td><td>func@0x180123b90</td><td>[Unknown]</td><td>0x180123b90</td></tr>
    <tr data-tt-id="13" data-tt-parent-id="11"><td>func@0x1801233b0</td><td>0</td><td>opencv_imgcodecs331.dll</td><td>func@0x1801233b0</td><td>[Unknown]</td><td>0x1801233b0</td></tr>
    </table>
</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-treetable/3.2.0/jquery.treetable.min.js"></script>




    <script>
    var vm = new Vue({
    el: '#vued3chart',
    data: {
      data: [4, 8, 15, 16, 23, 42]
    },
    methods: {
      renderChart: function(data) {
        // This code is based on https://bost.ocks.org/mike/bar/2/
        var width = 750,
            barHeight = 20;
        var x = d3.scale.linear()
            .domain([0, d3.max(data)])
            .range([0, width]);
        var vuechart = d3.select(this.$el)
            .attr("width", width)
            .attr("height", barHeight * data.length);
        var d = vuechart.selectAll("g")
            .data(data);
       
        var g = d.enter().append("g")
            .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

        g.append("rect")
            .attr("width", x)
            .attr("height", barHeight - 1);
        g.append("text")
            .attr("x", function(d) { return x(d) - 3; })
            .attr("y", barHeight / 2)
            .attr("dy", ".35em")
            .text(function(d) { return d; });
      }
    },
    mounted: function() {
      this.renderChart(this.$data.data);
    },
    watch: {
      data: function(val) {
        this.renderChart(val);
      }
    }
  });

  new Vue({
          el: "#vuec3chart",
          mounted: function() {
              c3.generate({
              bindto: this.$el,
              data: {
                  type: "area",
                  x: "x",
                  xFormat: "%H:%M",
                  columns: [
                     [
                       "x",
                       "12:38",
                       "12:39",
                       "12:40",
                       "12:41",
                       "12:42",
                       "12:43",
                       "12:44",
                       "12:45",
                       "12:46",
                       "12:47",
                       "12:48",
                       "12:49",
                       "12:50",
                       "12:51",
                       "12:52",
                       "12:53",
                       "12:54",
                       "12:55",
                       "12:56",
                       "12:57",
                       "12:58",
                       "12:59",
                     ],
                     [
                       "write",
                       9884,
                       1353,
                       2243,
                       3302,
                       3443,
                       5731,
                       4163,
                       8329,
                       8809,
                       3145,
                       5843,
                       9190,
                       0899,
                       6873,
                       7113,
                       0870,
                       0700,
                       8144,
                       8624,
                       9513,
                       6307,
                       6307,
                     ],
                     [
                       "read",
                       848,
                       536,
                       432,
                       024,
                       432,
                       312,
                       632,
                       296,
                       096,
                       456,
                       432,
                       904,
                       992,
                       736,
                       136,
                       704,
                       808,
                       440,
                       240,
                       136,
                       072,
                       073,
                     ]
                  ]             
                },              
            axis: {
              x: {
                  type: "timeseries",
                  tick: {
                      format: '%H:%M'
                  }
              }
            }
      });
    }
  });
  (function () {
      const vscode = acquireVsCodeApi();
      const counter = document.getElementById("lines-of-code-counter");
      const commMsg = document.getElementById("latest-comm");
      const shouldDisplay = document.getElementById("container");
      let count = 0;
      setInterval( () => {
          counter.textContent = count++;
          if ((count % 250) === 0) {
              console.log("Sending a message to the host...");
              vscode.postMessage({
                  command: 'alert',
                  text: 'communicating with host'
              });
          }
      }, 500);

      // allow the expandable nature of the profile table
      $("#table-profile").treetable({ expandable: true, initialState : "expanded" });

     let data = JSON.parse(document.getElementById("dataDiv").textContent);
     let data2 = JSON.parse(document.getElementById("dataDiv2").textContent);
      // a second chart
      var chart = c3.generate({
          bindto: '#visitor',
          data: {
              columns : data,
              type: 'donut',
              tooltip: {
                  show: true
              }
          },
          donut: {
              label: {
                  show: false
              },
              title: "Modules",
              width: 35,
          },
          legend: {
              hide: true
          },
          color: {
              pattern: ['#40c4ff', '#2961ff', '#ff821c', '#7e74fb']
          }
      });

      var dataset = [ 5, 10, 15, 20, 25 ];
      var chart = c3.generate({
       bindto: '#chart',
       data: {
         columns: [
           ['data1', 30, 200, 100, 400, 150, 250],
           ['data2', 50, 20, 10, 40, 15, 25]
         ],
         axes: {
           data2: 'y2' // ADD
         }
       },
       axis: {
         y2: {
           show: true // ADD
         }
       }
       });

       var chart = c3.generate({
          bindto: '#chart2',
          data: {
              json: data2
          }
      });
       var dataset = [ 5, 10, 15, 14];
      d3.select("body").selectAll("p")
           .data(dataset)
           .enter()
           .append("p")
           .text("New paragraph!");
     //  Handle a message inside the webview
     document.getElementById("message").textContent = "hello";
      window.addEventListener('message', event => {
          const message = event.data; // the message data the host sent
          //shouldDisplay.style.visibility = "visible";
          document.getElementById("message").textContent = "testing";

          counter.textContent = 10;
          commMsg.textContent = "Just received a message at time [" + count + "]";
          console.log("This should be displayed in the developer tools if they're open");

      });
  })();
    </script>
    
  </body>
</html>
